{% extends 'diary/base.html' %}

{% block content %}
<h1 class="text-center"> –ú–æ—è –∫–Ω–∏–∂–Ω–∞—è –ø–æ–ª–∫–∞ </h1>

<!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
<form method="GET" action="{% url 'book_list' %}" class="mb-3">
    <input type="text" name="q" value="{{ query }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∞–≤—Ç–æ—Ä–∞">
    <button type="submit">üîç –ü–æ–∏—Å–∫</button>
</form>

<a href="{% url 'book_create' %}" class="btn btn-success mb-3">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>

<div class="bookshelf">
  <h3>üìö –ú–æ–∏ –∫–Ω–∏–≥–∏</h3>
  {% if books %}
    <div class="book-row"> <!-- –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ä—è–¥ -->
    {% for book in books %}
      <div class="book-card" style="background-color: {{ colors|random }};">
        <div class="book-cover">
          <img src="https://kniga.lv/icache/b99834bc/67860a1c/0359cbdd.jpg" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏">
        </div>
        <div class="book-info">
          <h5>{{ book.name }}</h5>
          <p class="mb-1 text-muted book-author">{{ book.author }}</p>
          <small class="text-muted">{{ book.get_genre_display }}</small>
        </div>
        <div class="book-actions">
          <a href="{% url 'book_detail' book.pk %}" class="btn btn-info">üëÅÔ∏è</a>
          <a href="{% url 'book_delete' book.pk %}" class="btn btn-danger">üóëÔ∏è</a>
        </div>
      </div>

      {% if forloop.counter|divisibleby:3 and not forloop.last %}
        </div><div class="book-row"> <!-- –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä—è–¥ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—ã–π -->
      {% endif %}
      
    {% endfor %}
    </div> <!-- –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä—è–¥ -->
  {% else %}
    <p class="text-center">–í—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –∫–Ω–∏–≥–∏.</p>
  {% endif %}
</div>

<!-- –†–∞–∑–¥–µ–ª —Å –∫–Ω–∏–≥–∞–º–∏ –∏–∑ Open Library API -->
{% if api_books %}
<div class="bookshelf">
  <h3>üåç –ù–∞–π–¥–µ–Ω–æ –≤ Open Library</h3>
  <div class="book-row">
    {% for book in api_books %}
      <div class="book-card" style="background-color: {{ colors|random }};">
        <div class="book-cover">
          <img src="{{ book.cover }}" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏">
        </div>
        <div class="book-info">
          <h5>{{ book.title }}</h5>
          <p class="mb-1 text-muted book-author">{{ book.author }}</p>
        </div>
        <div class="book-actions">
            <form method="POST" action="{% url 'add_book_from_api' %}">
                {% csrf_token %}
                <input type="hidden" name="title" value="{{ book.title }}">
                <input type="hidden" name="author" value="{{ book.author }}">
                <input type="hidden" name="cover" value="{{ book.cover }}">
                <input type="hidden" name="year" value="{{ book.year }}">
                <button type="submit" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
        </div>
      </div>
      {% if forloop.counter|divisibleby:3 %}
        </div><div class="book-row">
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endif %}

{% endblock %}